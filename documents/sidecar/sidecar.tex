\section{The Project}

\subsection{Status On Apache}

\emph{status.conf}
\begin{apachecode*}{}
  <Location /server-status>
  SetHandler server-status
  Order deny,allow
  Allow from all
  </Location> ExtendedStatus On
\end{apachecode*}

and  \emph{Dockerfile}

\begin{dockercode*}{}
  RUN a2enmod status
  COPY status.conf /etc/apache2/mods-enabled/
\end{dockercode*}

\subsection{Secret Access}

We firstly define our \emph{secret file}

\begin{yamlcode*}{}
  apiVersion: v1
  kind: Secret
  metadata:
  name: github-secret
  namespace: sidecar
  type: kubernetes.io/basic-auth
  data:
  username: c3Bpa2U=
  password: dmFsZW50aW5l
\end{yamlcode*}

\emph{username} and \emph{password} are defined with the command

\begin{minted}{bash}
  $ echo -n 'spike' | base64
  c3Bpa2U=
  $ echo -n 'valentine' | base64
  dmFsZW50aW5l
\end{minted}

and we run

\begin{minted}{bash}
  $ oc create -f gitlab-secret.yaml
\end{minted}

\subsection{New Project}

Firstly, we create a new project

\begin{minted}{bash}
  $ oc new-project sidecar \
  --display-name='Side Car Project' \
  --description='Side Car Project'
\end{minted}

\subsection{New Build}

To obtain our image, we firstly
\begin{minted}{bash}
  $ oc new-build http://192.168.0.8:8880/spike/faye.git \
  --name faye
\end{minted}

But to resolve the issue based on the credential, we'll attribute the \emph{login/password} defined before and retstart the build process.

\begin{minted}{bash}
  $ oc set build-secret --source bc/faye github-secret
  $ oc start-build faye
\end{minted}

or directly
\begin{minted}{bash}
  $  oc new-build http://192.168.0.8:8880/spike/faye.git \
  --source-secret github-secret
  --name faye
\end{minted}

\subsection{New Application}

It's time to create our application

\begin{minted}{bash}
  $ oc new-app faye \
  --name fayeapp
  $ oc status
  $ oc expose service faye
  $ oc get pod
  $ oc get all name --selector app=cdnselect
\end{minted}

\section{The Side Car}

\subsection{Export}

We firstly export our \emph{project}.

\begin{minted}{bash}
  $ oc get --export is,bc,dc,svc -o yaml > export.yaml
\end{minted}

\subsection{ImageStream}
We delete \emph{resourceVersion, selfLink and uid}. In status, we keep dockerImageRepository (set to "")

\subsection{BuildConfig}
We delete \emph{resourceVersion, selfLink and uid}. We delete in spec.triggers.imageChange \emph{lastTriggeredImageID}

\subsection{DeploymentConfig}
We replace spec.template.spec.containers.image by \emph{faye} in the first container
We add in spec.template.spec.container

\begin{minted}{bash}
  - name: apache-exporter
  image: previousnext/apache-exporter
  command: [ "apache_exporter", "-scrape_uri", "http://127.0.0.1:8080/server-status/?auto" ]
  ports:
  - containerPort: 9117
\end{minted}

\subsection{Service}
We delete \emph{resourceVersion, selfLink and uid}.

We add in spec.ports

\begin{minted}{bash}
  - name: 9117-tcp
  port: 9117
  protocol: TCP
  targetPort: 9117
\end{minted}